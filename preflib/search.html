---
layout: default
title: PrefLib | Search
sitemap:
  priority: 1
---

<section>

<h1>Explore the Data Files</h1>

<p>
	Use the following form to search for data files matching your requirements.
</p>
<p>
	For the three-valued fields, you can choose whether it should be the case (&#10003;), it should
	not be the case (&#10007;), or if it does not matter (&#10003;/&#10007;). For the slider fields,
	you can either use the slider or the input fields, press enter after changing the values in the
	input fields. Once all the criteria have been selected, press the search button to display the results.
</p>

</section>

<section>
{% assign all_data_types = site.data.datafiles | map: "data_type" | uniq %}
{% assign all_modification_types = site.data.datafiles | map: "modification_type" | uniq %}

<form id="filters">
    <div class="filters-wrap">
        <div class="filter-group">
            <h3>Instance Size</h3>
            <div class="filter-wrap">
                <div class="filter-label">
                    Number of voters
                </div>
                <div class="filter-select-wrap">
                    {% assign max_voters = 0 %}
                    {% assign first_file = site.data.datafiles | first %}
                    {% assign min_voters = first_file.num_voters %}

                    {% for file in site.data.datafiles %}
                        {% if file.num_voters > max_voters %}
                            {% assign max_voters = file.num_voters %}
                        {% endif %}
                        {% if file.num_voters < min_voters %}
                            {% assign min_voters = file.num_voters %}
                        {% endif %}
                    {% endfor %}
                    {% include range_selector.html id="nvoter-selector" min=min_voters max=max_voters %}
                </div>
            </div>
            <div class="filter-wrap">
                <div class="filter-label">
                    Number of alternatives
                </div>
                <div class="filter-select-wrap">
                    {% assign max_alt = 0 %}
                    {% assign min_alt = first_file.num_alternatives %}

                    {% for file in site.data.datafiles %}
                        {% if file.num_alternatives > max_alt %}
                            {% assign max_alt = file.num_alternatives %}
                        {% endif %}
                        {% if file.num_alternatives < min_alt %}
                            {% assign min_alt = file.num_alternatives %}
                        {% endif %}
                    {% endfor %}
                    {% include range_selector.html id="nalt-selector" min=min_alt max=max_alt %}
                </div>
            </div>
            <div class="filter-wrap">
                <div class="filter-label">
                    Number of unique preferences
                </div>
                <div class="filter-select-wrap">
                    {% assign max_pref = 0 %}
                    {% assign min_pref = first_file.num_unique_preferences %}

                    {% for file in site.data.datafiles %}
                        {% if file.num_unique_preferences > max_pref %}
                            {% assign max_pref = file.num_unique_preferences %}
                        {% endif %}
                        {% if file.num_unique_preferences < min_pref %}
                            {% assign min_pref = file.num_unique_preferences %}
                        {% endif %}
                    {% endfor %}
                    {% include range_selector.html id="nuniqpref-selector" min=min_pref max=max_pref %}
                </div>
            </div>
        </div>
    </div>

	<div class="filters-wrap">
		<div class="filter-group" id="filter-data-type-group">
			<h3>Type of Data</h3>
			{% for data_type in all_data_types %}
				<div class="filter-wrap">
					<div class="filter-label"><a href="{{ 'format#' | append: data_type | relative_url }}">{{ data_type }}</a></div>
					<div class="filter-select-wrap">
						{% assign selector_id = "selector-" | append: data_type %}
						{% include tri_value_selector.html id=selector_id %}
					</div>
				</div>
			{% endfor %}
		</div>

		<div class="filter-group" id="filter-modification-type-group">
			<h3>Modification Type</h3>
			{% for modification_type in all_modification_types %}
				<div class="filter-wrap">
					<div class="filter-label">
						<a href="{{ 'format#modification' | relative_url }}">{{ modification_type }}</a>
					</div>
					<div class="filter-select-wrap">
						{% assign selector_id = "selector-" | append: modification_type %}
						{% include tri_value_selector.html id=selector_id %}
					</div>
				</div>
			{% endfor %}
		</div>

		<div class="filter-group" id="filter-structure-group">
			<h3>Structural Properties</h3>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Approval/Dichotomous preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-approval" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Single-peaked preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-singlepeaked" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Single-peaked on a circle preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-singlepeaked-circle" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Single-peaked on a tree preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-singlepeaked-tree" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Single-crossing preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-singlecrossing" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>1-Euclidean preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-one-euclidean" %}
				</div>
			</div>
			<div class="filter-wrap">
				<div class="filter-label">
					<a>Euclidean preferences?</a>
				</div>
				<div class="filter-select-wrap">
					{% include tri_value_selector.html id="selector-euclidean" %}
				</div>
			</div>
		</div>
	</div>
    <p style="text-align: center;">
        <span id="applyFilters" class="download-button">Apply Filters</span>
    </p>
</form>

</section>
<section>
<div class="pagination_wrapper" id="paginator-top">
    <div class="pagination"></div>
</div>

<div id="search-result"></div>

<div class="pagination_wrapper" id="paginator-bottom">
    <div class="pagination"></div>
</div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {

	{% include tri_value_selector_uniq_propagate.js values=all_data_types %}
	{% include tri_value_selector_uniq_propagate.js values=all_modification_types %}

	const itemsPerPage = 50;  // Number of papers per page
    const searchResult = document.getElementById('search-result');
    const paginatorTop = document.querySelector('#paginator-top .pagination');
    const paginatorBottom = document.querySelector('#paginator-bottom .pagination');

    // Pull in data from Jekyll
    const allFiles = {{ site.data.datafiles | jsonify }};  // Ensure this line is present
    let filteredFiles = allFiles;

    let currentPage = 1;

    // Function to apply filters
    function applyFilters() {
        const nvoter_lb = parseInt(document.getElementById("nvoter-selector-lb").value);
        const nvoter_ub = parseInt(document.getElementById("nvoter-selector-ub").value);
        const nalt_lb = parseInt(document.getElementById("nalt-selector-lb").value);
        const nalt_ub = parseInt(document.getElementById("nalt-selector-ub").value);
        const nuniqpref_lb = parseInt(document.getElementById("nuniqpref-selector-lb").value);
        const nuniqpref_ub = parseInt(document.getElementById("nuniqpref-selector-ub").value);

        // Filter structural properties (approval, single-peaked, etc.)
        const approvalFilter = document.querySelector('input[name="selector-approval"]:checked').value;
        const singlePeakedFilter = document.querySelector('input[name="selector-singlepeaked"]:checked').value;

        let acceptableDataTypes = [{% for t in all_data_types %}'{{ t }}',{% endfor %}];
        const allTypeSelectors = document.querySelectorAll('#filter-data-type-group .tri-value-selector-no');
        allTypeSelectors.forEach(selector => {
          if (selector.checked) {
            let dataType = selector.name.replace('selector-', '');
            acceptableDataTypes = acceptableDataTypes.filter(item => item !== dataType);
          }
        });

        let acceptableModifTypes = [{% for t in all_modification_types %}'{{ t }}',{% endfor %}];
        const allModifSelectors = document.querySelectorAll('#filter-modification-type-group .tri-value-selector-no');
        allModifSelectors.forEach(selector => {
          if (selector.checked) {
            let modifType = selector.name.replace('selector-', '');
            acceptableModifTypes = acceptableModifTypes.filter(item => item !== modifType);
          }
        });

        // Apply filters one by one
        filteredFiles = allFiles.filter(file => {
            // Check for number of voters
            const numVotersMatch = (file.num_voters >= nvoter_lb && file.num_voters <= nvoter_ub);

            // Check for number of alternatives
            const numAlternativesMatch = (file.num_alternatives >= nalt_lb && file.num_alternatives <= nalt_ub);

            // Check for number of unique preferences
            const numUniqPrefsMatch = (file.num_unique_preferences >= nuniqpref_lb && file.num_unique_preferences <= nuniqpref_ub);

            // Apply approval filter (trinary logic: yes, no, or undefined)
            const approvalMatch = approvalFilter === "indef" ||
                                  (approvalFilter === "yes" && file.is_approval) ||
                                  (approvalFilter === "no" && !file.is_approval);

            // Apply single-peaked filter
            const singlePeakedMatch = singlePeakedFilter === "indef" ||
                                      (singlePeakedFilter === "yes" && file.is_single_peaked) ||
                                      (singlePeakedFilter === "no" && !file.is_single_peaked);

            // Filter based on data type (e.g., csv)
            const dataTypeMatch = acceptableDataTypes.includes(file.data_type);

            // Apply modification type filter
            const modificationTypeMatch = acceptableModifTypes.includes(file.modification_type);

            // Combine all filters (use logical AND to ensure all conditions are met)
            return numVotersMatch && numAlternativesMatch && numUniqPrefsMatch && approvalMatch && singlePeakedMatch && dataTypeMatch && modificationTypeMatch;
        });

        currentPage = 1; // Reset to the first page after filtering
        renderFiles(currentPage);
        renderPagination(paginatorTop);
        renderPagination(paginatorBottom);
    }

    function renderFiles(page) {
        searchResult.innerHTML = '';
        if (filteredFiles.length === 0) {
            searchResult.innerHTML = '<p>There is no file matching to your query.</p>'
        } else {
            let startIndex = (page - 1) * itemsPerPage;
            let endIndex = startIndex + itemsPerPage;

            let filesToShow = filteredFiles.slice(startIndex, endIndex);

            searchResult.innerHTML += `
                <span class="header odd-line">Dataset</span>
                <span class="header odd-line">File</span>
                <span class="header odd-line">Type</span>
                <span class="header odd-line">Modif.</span>
                <span class="header odd-line">#Voters</span>
                <span class="header odd-line">#Alt.</span>
                <span class="header odd-line"></span>`;
            filesToShow.forEach(function (file, index) {
                let rowClass = (index % 2 === 0) ? 'even-line' : 'odd-line';
                searchResult.innerHTML += `
                    <span class="${rowClass}">${file.dataset}</span>
                    <span class="${rowClass}">${file.name}</span>
                    <span class="${rowClass}">${file.data_type}</span>
                    <span class="${rowClass}">${file.modification_type}</span>
                    <span class="${rowClass}">${file.num_voters}</span>
                    <span class="${rowClass}">${file.num_alternatives}</span>
                    <span class="${rowClass}"><a href="${file.url}" class="download-button" target="_blank" download>Download</a></span>`;
            });
        }
    }

    function renderPagination(paginator) {
    paginator.innerHTML = '';

    // Calculate total pages for filtered results
    const totalPages = Math.ceil(filteredFiles.length / itemsPerPage);

    if (totalPages > 1) {
        if (currentPage > 1) {
            paginator.innerHTML += `<a href="#" data-page="${currentPage - 1}">«</a>`;
        } else {
            paginator.innerHTML += `<a>«</a>`;
        }

        if (totalPages <= 10) {
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginator.innerHTML += `<a class="active" href="#" data-page="${i}">${i}</a>`;
                } else {
                    paginator.innerHTML += `<a href="#" data-page="${i}">${i}</a>`;
                }
            }
        } else {
            paginator.innerHTML += `<a href="#" data-page="1" ${currentPage === 1 ? 'class="active"' : ''}>1</a>`;
            paginator.innerHTML += `<a href="#" data-page="2" ${currentPage === 2 ? 'class="active"' : ''}>2</a>`;
            if (currentPage > 4) {
                paginator.innerHTML += `<a>...</a>`;
            }
            for (let i = Math.max(3, currentPage - 2); i <= Math.min(totalPages - 2, currentPage + 2); i++) {
                if (i === currentPage) {
                    paginator.innerHTML += `<a class="active" href="#" data-page="${i}">${i}</a>`;
                } else {
                    paginator.innerHTML += `<a href="#" data-page="${i}">${i}</a>`;
                }
            }
            if (currentPage < totalPages - 2) {
                paginator.innerHTML += `<a>...</a>`;
            }
            if (totalPages > 2) {
                paginator.innerHTML += `<a href="#" data-page="${totalPages - 1}" ${currentPage === totalPages - 1 ? 'class="active"' : ''}>${totalPages - 1}</a>`;
            }
            if (totalPages > 1) {
                paginator.innerHTML += `<a href="#" data-page="${totalPages}" ${currentPage === totalPages ? 'class="active"' : ''}>${totalPages}</a>`;
            }
        }

        if (currentPage < totalPages) {
            paginator.innerHTML += `<a href="#" data-page="${currentPage + 1}">»</a>`;
        } else {
            paginator.innerHTML += `<a>»</a>`;
        }

        // Add event listeners for page links
        const pageLinks = paginator.querySelectorAll('a[data-page]');
        pageLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                currentPage = parseInt(this.getAttribute('data-page'));
                renderFiles(currentPage);
                renderPagination(paginatorTop);
                renderPagination(paginatorBottom);
            });
        });
    }
}


    // Initial render
    renderFiles(currentPage);
    renderPagination(paginatorTop);
    renderPagination(paginatorBottom);

    document.getElementById('applyFilters').addEventListener('click', applyFilters);
});
</script>
